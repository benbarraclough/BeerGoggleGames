---
import '../styles.css';
import Analytics from './Analytics.astro';

const {
  title = 'Beer Goggle Games',
  description = 'Drinking games, cocktails, party activities & more.',
  ogImage
} = Astro.props;

// Normalize base: always leading slash, single trailing slash unless root.
function normalizeBase(b) {
  if (!b) return '/';
  b = b.trim();
  if (!b.startsWith('/')) b = '/' + b;
  b = b.replace(/\/+$/,'');
  return b === '' ? '/' : b + '/';
}

const rawBase = import.meta.env.BASE_URL || '/';
const base = normalizeBase(rawBase);

function withBase(path = '') {
  const p = path.replace(/^\/+/, '');
  return base + p;
}
---
<!DOCTYPE html>
<html lang="en" class="bg-bg text-fg" data-base={base}>
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {ogImage && <meta property="og:image" content={withBase(ogImage.replace(/^\/+/, ''))} />}
  </head>
  <body class="min-h-screen flex flex-col">
    <header class="border-b border-fg/20">
      <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
        <a href={withBase()} class="font-display text-2xl tracking-tight hover:text-neon">BeerGoggleGames</a>
        <nav class="flex gap-4 text-sm">
          <a href={withBase('games/')} class="hover:text-neon">Games</a>
          <a href={withBase('drinks/')} class="hover:text-neon">Drinks</a>
          <a href={withBase('activities/')} class="hover:text-neon">Activities</a>
          <a href={withBase('blog/')} class="hover:text-neon">Blog</a>
          <a href={withBase('search')} class="hover:text-neon">Search</a>
          <a href={withBase('contact')} class="hover:text-neon">Contact</a>
        </nav>
      </div>
    </header>
    <main class="grow mx-auto max-w-6xl px-4 py-8">
      <slot />
    </main>
    <footer class="border-t border-fg/20">
      <div class="mx-auto max-w-6xl px-4 py-6 text-sm text-muted flex items-center justify-between">
        <span>Â© {new Date().getFullYear()} Beer Goggle Games</span>
        <a class="hover:text-neon" href={withBase('rss.xml')}>RSS</a>
      </div>
    </footer>
    <script is:inline>
      console.log('Layout base debug:', { rawBase: {JSON.stringify(rawBase)}, normalized: {JSON.stringify(base)} });
    </script>
    <Analytics />
  </body>
</html>
