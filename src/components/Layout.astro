---
import '../styles.css';
import Analytics from './Analytics.astro';
import SkipLink from './SkipLink.astro';
import { base, withBase } from '../lib/paths';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  canonical?: string;
  wide?: boolean;      // max-w-7xl
  fullBleed?: boolean; // no max width constraint
}

const {
  title = 'Beer Goggle Games',
  description = 'Drinking games, cocktails, party activities & more.',
  ogImage,
  canonical,
  wide = false,
  fullBleed = false
} = Astro.props as Props;

const current = Astro.url.pathname;
function isActive(segment: string) {
  const normalized = segment.endsWith('/') ? segment : segment + '/';
  return current.startsWith(withBase(normalized));
}

const mainClass = [
  'grow mx-auto w-full px-4 py-8',
  fullBleed ? '' : (wide ? 'max-w-7xl' : 'max-w-6xl')
].join(' ');
---
<!DOCTYPE html>
<html lang="en" class="bg-bg text-fg font-body antialiased" data-base={base}>
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {canonical && <link rel="canonical" href={canonical} />}
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    {ogImage && <meta property="og:image" content={withBase(ogImage.replace(/^\/+/, ''))} />}
  </head>
  <body class="min-h-screen flex flex-col selection:bg-neon/40">
    <SkipLink />
    <header class="border-b border-fg/20">
      <div class="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between">
        <a href={withBase()} class="font-display text-2xl tracking-tight hover:text-neon">
          BeerGoggleGames
        </a>
        <nav class="flex flex-wrap gap-4 text-sm">
          <a href={withBase('games/')} class:list={['hover:text-neon', isActive('games') && 'text-neon font-semibold']} aria-current={isActive('games') ? 'page' : undefined}>Games</a>
            <a href={withBase('drinks/')} class:list={['hover:text-neon', isActive('drinks') && 'text-neon font-semibold']} aria-current={isActive('drinks') ? 'page' : undefined}>Drinks</a>
          <a href={withBase('activities/')} class:list={['hover:text-neon', isActive('activities') && 'text-neon font-semibold']} aria-current={isActive('activities') ? 'page' : undefined}>Activities</a>
          <a href={withBase('blog/')} class:list={['hover:text-neon', isActive('blog') && 'text-neon font-semibold']} aria-current={isActive('blog') ? 'page' : undefined}>Blog</a>
          <a href={withBase('search')} class:list={['hover:text-neon', isActive('search') && 'text-neon font-semibold']} aria-current={isActive('search') ? 'page' : undefined}>Search</a>
          <a href={withBase('contact')} class:list={['hover:text-neon', isActive('contact') && 'text-neon font-semibold']} aria-current={isActive('contact') ? 'page' : undefined}>Contact</a>
        </nav>
      </div>
    </header>
    <main id="main" class={mainClass}>
      <slot />
    </main>
    <footer class="border-t border-fg/20">
      <div class="mx-auto max-w-7xl px-4 py-6 text-sm text-muted flex items-center justify-between">
        <span>Â© {new Date().getFullYear()} Beer Goggle Games</span>
        <a class="hover:text-neon" href={withBase('rss.xml')}>RSS</a>
      </div>
    </footer>
    <Analytics />
  </body>
</html>
