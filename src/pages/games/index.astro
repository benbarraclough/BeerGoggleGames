---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';
import { withBase } from '../../lib/paths';
import { canonical } from '../../lib/urls';

const all = (await getCollection('games')).sort((a,b)=> a.data.title.localeCompare(b.data.title));
const PER_PAGE = 40;
const firstPage = all.slice(0, PER_PAGE);
const totalPages = Math.ceil(all.length / PER_PAGE);
const pageTitle = 'Games';
const pageCanonical = canonical(Astro.url.pathname, Astro.site);
---
<Layout title={pageTitle} canonical={pageCanonical} description="Index of drinking games.">
  <section class="prose prose-invert max-w-none">
    <h1>{pageTitle}</h1>
    <p>Total: {all.length}{totalPages > 1 && ` (Page 1 of ${totalPages})`}</p>
    <ul class="columns-1 sm:columns-2 lg:columns-3 gap-4 !mt-4">
      {firstPage.map(g => (
        <li class="break-inside-avoid">
          <a class="hover:text-neon" href={withBase(`games/${g.slug}/`)}>{g.data.title}</a>
          {g.data.type && <small class="text-muted"> ({g.data.type})</small>}
        </li>
      ))}
    </ul>
    {totalPages > 1 && (
      <p class="mt-4">
        More pages:{' '}
        {Array.from({ length: totalPages }, (_, i) => (
          <a class="inline-block mr-2 hover:text-neon" href={withBase(`games/page/${i + 1}/`)}>{i + 1}</a>
        ))}
      </p>
    )}
    <p class="mt-6 space-x-4">
      <a class="hover:text-neon" href={withBase('games/types/')}>Browse by Type</a>
      <a class="hover:text-neon" href={withBase('search')}>Search</a>
    </p>
  </section>
</Layout>
