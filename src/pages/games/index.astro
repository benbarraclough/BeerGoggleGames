---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';
import { withBase } from '../../lib/paths';
import { canonical } from '../../lib/urls';

const all = (await getCollection('games')).sort((a,b)=> a.data.title.localeCompare(b.data.title));
const PER_PAGE = 40;
const firstPage = all.slice(0, PER_PAGE);
const totalPages = Math.ceil(all.length / PER_PAGE);
const pageTitle = 'Games';
const pageCanonical = canonical(Astro.url.pathname, Astro.site);
---
<Layout title={pageTitle} canonical={pageCanonical} description="Index of drinking games.">
  <h1 class="font-display text-4xl mb-2">{pageTitle}</h1>
  <p class="text-sm text-muted mb-6">Total: {all.length}{totalPages > 1 && ` (Page 1 of ${totalPages})`}</p>

  <ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 list-none p-0 m-0">
    {firstPage.map(g => (
      <li class="border border-fg/15 hover:border-fg/40 transition-colors p-4">
        <a class="font-semibold hover:text-neon" href={withBase(`games/${g.slug}/`)}>{g.data.title}</a>
        {g.data.type && <div class="text-xs text-muted mt-1 uppercase tracking-wide">{g.data.type}</div>}
      </li>
    ))}
  </ul>

  {totalPages > 1 && (
    <nav class="mt-6 text-sm flex flex-wrap items-center gap-2" aria-label="Pagination">
      <span class="text-muted">Pages:</span>
      {Array.from({ length: totalPages }, (_, i) => (
        <a
          class:list={[
            'px-2 py-1 border border-fg/20 hover:border-fg/50 hover:text-neon',
            i === 0 && 'bg-fg/5'
          ]}
          href={withBase(`games/page/${i + 1}/`)}
        >
          {i + 1}
        </a>
      ))}
    </nav>
  )}

  <div class="mt-8 text-sm space-x-6">
    <a class="hover:text-neon underline-offset-4 hover:underline" href={withBase('games/types/')}>Browse by Type</a>
    <a class="hover:text-neon underline-offset-4 hover:underline" href={withBase('search')}>Search</a>
  </div>
</Layout>
