---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';
const base = import.meta.env.BASE_URL || '/';
const all = (await getCollection('games')).sort((a,b)=> a.data.title.localeCompare(b.data.title));
const PER_PAGE = 40;
const firstPage = all.slice(0, PER_PAGE);
const totalPages = Math.ceil(all.length / PER_PAGE);
const pageTitle = 'Games';
---
<Layout title={pageTitle}>
  <section class="prose max-w-none">
    <h1>{pageTitle}</h1>
    <p>Total: {all.length}{totalPages > 1 && ` (Page 1 of ${totalPages})`}</p>
    <ul class="columns-1 sm:columns-2 lg:columns-3 gap-4 !mt-4">
      {firstPage.map(g => (
        <li class="break-inside-avoid">
          <a class="text-blue-600 hover:underline" href={`${base}games/${g.slug}/`}>{g.data.title}</a>
          {g.data.type && <small class="text-gray-500"> ({g.data.type})</small>}
        </li>
      ))}
    </ul>
    {totalPages > 1 && (
      <p class="mt-4">
        More pages:{' '}
        {Array.from({ length: totalPages }, (_, i) => (
          <a class="inline-block mr-2 text-blue-600 hover:underline" href={`${base}games/page/${i + 1}/`}>{i + 1}</a>
        ))}
      </p>
    )}
    <p class="mt-6 space-x-4">
      <a class="text-blue-600 hover:underline" href={`${base}games/types/`}>Browse by Type</a>
      <a class="text-blue-600 hover:underline" href={`${base}search`}>Search</a>
    </p>
  </section>
</Layout>
