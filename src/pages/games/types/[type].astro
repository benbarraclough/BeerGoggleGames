---
import Layout from '../../../components/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const games = await getCollection('games');
  const types = [...new Set(games.map(g => g.data.type).filter(Boolean))];
  return types.map(type => ({ params: { type }, props: { type } }));
}

const base = import.meta.env.BASE_URL || '/';
const { type } = Astro.props;
const items = (await getCollection('games'))
  .filter(g => g.data.type === type)
  .sort((a,b)=> a.data.title.localeCompare(b.data.title));
const pageTitle = `${type} Games`;
---
<Layout title={pageTitle}>
  <section class="prose max-w-none">
    <h1>{pageTitle}</h1>
    <ul class="columns-1 sm:columns-2 lg:columns-3 gap-4 !mt-4">
      {items.map(g => (
        <li class="break-inside-avoid">
          <a class="text-blue-600 hover:underline" href={`${base}games/${g.slug}/`}>{g.data.title}</a>
        </li>
      ))}
    </ul>
    <p class="mt-6 space-x-4">
      <a class="text-blue-600 hover:underline" href={`${base}games/types/`}>All Types</a>
      <a class="text-blue-600 hover:underline" href={`${base}games/`}>All Games</a>
    </p>
  </section>
</Layout>
