---
import Layout from '../../../components/Layout.astro';
import { getCollection } from 'astro:content';
import { canonical } from '../../../lib/urls';
import { withBase } from '../../../lib/paths';

const pageCanonical = canonical(Astro.url.pathname, Astro.site);

const games = (await getCollection('games')).filter(g => g.data.type);
const byType = new Map<string, number>();
for (const g of games) {
  const t = g.data.type || 'misc';
  byType.set(t, (byType.get(t) || 0) + 1);
}
const typeEntries = Array.from(byType.entries()).sort((a,b)=> a[0].localeCompare(b[0]));
---
<Layout title="Game Types" description="Browse game categories." canonical={pageCanonical}>
  <h1 class="font-display text-4xl mb-6">Game Types</h1>
  <p class="text-sm text-muted mb-6">
    Same categories as <a class="hover:text-neon underline underline-offset-4" href={withBase('games/')}>main types page</a>.  
    Pick one to see all games.
  </p>

  {typeEntries.length === 0 ? (
    <p class="text-muted">No game types yet.</p>
  ) : (
    <ul class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 list-none m-0 p-0">
      {typeEntries.map(([type, count]) => (
        <li class="border border-fg/15 hover:border-fg/40 transition-colors p-4 flex flex-col">
          <a class="font-semibold text-lg hover:text-neon" href={withBase(`games/types/${type}/`)}>{type}</a>
          <div class="text-xs text-muted mt-1">{count} game{count !== 1 && 's'}</div>
        </li>
      ))}
    </ul>
  )}
</Layout>
