---
import Layout from '../components/Layout.astro';
import { getCollection } from 'astro:content';
import { excludeLegacyNoise } from '../lib/filters';
import { withBase } from '../lib/paths';
import { canonical } from '../lib/urls';
import CardLink from '../components/CardLink.astro';

const allGames = excludeLegacyNoise(await getCollection('games'));
const recentGames = allGames.slice(0, 12); // more items for carousel

const posts = excludeLegacyNoise(await getCollection('posts'))
  .filter(p => !p.data.draft)
  .sort((a,b) => (b.data.date || '').localeCompare(a.data.date || ''))
  .slice(0, 6);

const cocktails = excludeLegacyNoise(await getCollection('cocktails')).slice(0,8);
const shots = excludeLegacyNoise(await getCollection('shots')).slice(0,8);

const pageCanonical = canonical(Astro.url.pathname, Astro.site);
---
<Layout title="BeerGoggleGames" description="Drinking games, cocktails & shots, forfeits, glossary and wheel tools." canonical={pageCanonical} wide={true}>
  <!-- HERO -->
  <section class="relative overflow-hidden rounded-lg border border-fg/15 mb-12 bg-gradient-to-br from-fg/5 via-fg/0 to-neon/10">
    <div class="absolute inset-0 pointer-events-none opacity-40 mix-blend-overlay radial-fade"></div>
    <div class="relative px-6 py-14 md:py-20 flex flex-col gap-8 md:flex-row md:items-center md:justify-between">
      <div class="max-w-xl space-y-5">
        <h1 class="font-display text-4xl md:text-5xl leading-tight tracking-tight">Party Faster. Play Smarter.</h1>
        <p class="text-muted text-lg leading-relaxed">
          Discover streamlined drinking games, curated cocktails & shots, creative forfeits
          and quick decision tools. Minimal fluff. Maximum fun.
        </p>
        <div class="flex flex-wrap gap-3">
          <a href={withBase('games/')} class="px-5 py-3 rounded border border-fg/25 bg-fg/10 hover:border-neon hover:text-neon text-sm font-medium tracking-wide">
            Browse Games
          </a>
          <a href={withBase('extras/wheel-of-fortune/')} class="px-5 py-3 rounded border border-neon/40 text-neon hover:bg-neon/10 text-sm font-medium tracking-wide">
            Spin a Wheel →
          </a>
        </div>
      </div>
      <!-- Image area (drop in an image later) -->
      <div class="w-full max-w-md">
        <div class="aspect-[4/3] rounded-md border border-fg/20 bg-gradient-to-br from-fg/10 to-fg/5 flex items-center justify-center text-muted">
          <span class="text-xs">Add hero image here (4:3)</span>
        </div>
      </div>
    </div>
  </section>

  <!-- QUICK ACCESS -->
  <section class="mb-14">
    <h2 class="font-display text-2xl mb-5">Quick Access</h2>
    <ul class="grid gap-5 sm:grid-cols-2 lg:grid-cols-4 list-none p-0 m-0">
      {[
        { label: 'Random Game', href: withBase('games/random'), desc: 'Let fate decide your next play.' },
        { label: 'Forfeits', href: withBase('extras/forfeits'), desc: 'Creative penalties & challenges.' },
        { label: 'Glossary', href: withBase('extras/glossary'), desc: 'Decode the drinking jargon.' },
        { label: 'Wheel Tool', href: withBase('extras/wheel-of-fortune'), desc: 'Spin categories & games.' }
      ].map(i => (
        <li class="group border border-fg/15 rounded-lg p-5 hover:border-neon transition-colors bg-fg/5/10">
          <a href={i.href} class="flex flex-col gap-2 h-full focus:outline-none focus:ring-2 focus:ring-neon rounded">
            <span class="font-semibold group-hover:text-neon">{i.label}</span>
            <span class="text-xs text-muted leading-snug">{i.desc}</span>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <!-- CAROUSEL: Latest Games -->
  <section class="mb-14">
    <header class="flex items-center justify-between mb-3">
      <h2 class="font-display text-2xl">Latest Games</h2>
      <div class="flex gap-2">
        <button class="carousel-btn" data-target="#games-carousel" data-dir="-1" aria-label="Previous">‹</button>
        <button class="carousel-btn" data-target="#games-carousel" data-dir="1" aria-label="Next">›</button>
      </div>
    </header>
    <div id="games-carousel" class="carousel">
      {recentGames.map(g => {
        const slug = (g.slug ?? g.id).split('/').pop();
        const href = withBase(`games/${slug}/`);
        return (
          <div class="carousel-item">
            <div class="aspect-video rounded-md border border-fg/15 bg-fg/5 mb-2 flex items-center justify-center text-muted">
              <span class="text-[10px]">Add image: images/{slug}.webp</span>
            </div>
            <CardLink href={href} ariaLabel={`View game: ${g.data.title}`} as="div">
              <span class="font-semibold leading-snug transition-colors group-hover:text-neon">
                {g.data.title}
              </span>
              {g.data.excerpt && <span class="mt-2 text-[11px] text-muted line-clamp-3">{g.data.excerpt}</span>}
            </CardLink>
          </div>
        );
      })}
    </div>
    <p class="mt-3 text-xs">
      <a class="hover:text-neon underline underline-offset-4" href={withBase('games/')}>All Games →</a>
    </p>
  </section>

  <!-- CAROUSEL: Drinks -->
  <section class="mb-14">
    <header class="flex items-center justify-between mb-3">
      <h2 class="font-display text-2xl">Popular Drinks</h2>
      <div class="flex gap-2">
        <button class="carousel-btn" data-target="#drinks-carousel" data-dir="-1" aria-label="Previous">‹</button>
        <button class="carousel-btn" data-target="#drinks-carousel" data-dir="1" aria-label="Next">›</button>
      </div>
    </header>
    <div id="drinks-carousel" class="carousel">
      {[...cocktails, ...shots].map(d => {
        const slug = (d.slug ?? d.id).split('/').pop();
        const href = withBase(`drinks/${slug}/`);
        return (
          <div class="carousel-item">
            <div class="aspect-video rounded-md border border-fg/15 bg-fg/5 mb-2 flex items-center justify-center text-muted">
              <span class="text-[10px]">Add image: images/{slug}.webp</span>
            </div>
            <CardLink href={href} ariaLabel={`View drink: ${d.data.title}`} as="div">
              <span class="font-medium transition-colors group-hover:text-neon">{d.data.title}</span>
            </CardLink>
          </div>
        );
      })}
    </div>
    <p class="mt-3 text-xs">
      <a class="hover:text-neon underline underline-offset-4" href={withBase('drinks/')}>All Drinks →</a>
    </p>
  </section>

  <!-- BLOG TEASERS -->
  {posts.length > 0 && (
    <section class="mb-16">
      <header class="flex items-center justify-between mb-3">
        <h2 class="font-display text-2xl">From the Blog</h2>
        <a class="text-xs uppercase tracking-wide hover:text-neon underline underline-offset-4" href={withBase('extras/blog/')}>All Posts</a>
      </header>
      <div id="blog-carousel" class="carousel">
        {posts.map(p => {
          const slug = (p.slug ?? p.id).split('/').pop();
          return (
            <div class="carousel-item">
              <div class="aspect-[4/3] rounded-md border border-fg/15 bg-fg/5 mb-2 flex items-center justify-center text-muted">
                <span class="text-[10px]">Add blog image (optional)</span>
              </div>
              <CardLink href={withBase(`extras/blog/${slug}/`)} ariaLabel={`Read post: ${p.data.title}`} as="div">
                <span class="font-semibold leading-snug transition-colors group-hover:text-neon">
                  {p.data.title}
                </span>
                {p.data.excerpt && (
                  <span class="mt-2 text-xs text-muted line-clamp-3">
                    {p.data.excerpt}
                  </span>
                )}
              </CardLink>
            </div>
          );
        })}
      </div>
    </section>
  )}

  <style>
    .radial-fade {
      background:
        radial-gradient(circle at 20% 30%, rgba(var(--neon-rgb,255,0,128),0.25), transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(var(--neon-rgb,255,0,128),0.18), transparent 65%);
    }
    .carousel {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 80%;
      gap: 12px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 4px;
    }
    @media (min-width: 640px) { .carousel { grid-auto-columns: 45%; } }
    @media (min-width: 1024px) { .carousel { grid-auto-columns: 30%; } }
    .carousel::-webkit-scrollbar { height: 8px; }
    .carousel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 6px; }
    .carousel-item { scroll-snap-align: start; }
    .carousel-btn {
      @apply border border-fg/25 px-2 py-1 rounded text-sm hover:border-neon hover:text-neon;
    }
  </style>

  <script is:inline>
    (() => {
      function nudge(id, dir) {
        const el = document.querySelector(id);
        if (!el) return;
        const amount = el.clientWidth * 0.8;
        el.scrollBy({ left: amount * (dir || 1), behavior: 'smooth' });
      }
      document.querySelectorAll('.carousel-btn').forEach(btn => {
        btn.addEventListener('click', () => nudge(btn.getAttribute('data-target'), Number(btn.getAttribute('data-dir'))));
      });
    })();
  </script>
</Layout>
