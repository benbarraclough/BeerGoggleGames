---
import Layout from '../components/Layout.astro';
import { getCollection } from 'astro:content';
import { excludeLegacyNoise } from '../lib/filters';
import { withBase } from '../lib/paths';
import { canonical } from '../lib/urls';

const allGames = excludeLegacyNoise(await getCollection('games'));
const recentGames = allGames.slice(0, 6);

const posts = excludeLegacyNoise(await getCollection('posts'))
  .filter(p => !p.data.draft)
  .sort((a,b) => (b.data.date || '').localeCompare(a.data.date || ''))
  .slice(0, 3);

const cocktails = excludeLegacyNoise(await getCollection('cocktails')).slice(0,3);
const shots = excludeLegacyNoise(await getCollection('shots')).slice(0,3);

const pageCanonical = canonical(Astro.url.pathname, Astro.site);
---
<Layout title="BeerGoggleGames" description="Drinking games, cocktail & shot recipes, and party extras." canonical={pageCanonical} wide={false}>
  <h1 class="font-display text-4xl mb-6">BeerGoggleGames</h1>
  <p class="text-muted mb-10 max-w-prose">Drinking games, cocktail & shot recipes, and party extras. Fast, clean, mobile-ready.</p>

  <section class="mb-12">
    <h2 class="font-display text-2xl mb-4">Latest Games</h2>
    <ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 list-none p-0 m-0">
      {recentGames.map(g => {
        const slug = (g.slug ?? g.id).split('/').pop();
        const type = g.data.type || 'misc';
        return (
          <li class="list-none p-0 m-0">
            <a
              href={withBase(`games/${type}/${slug}/`)}
              class="group flex flex-col h-full border border-fg/20 rounded-sm p-4 transition-colors hover:border-neon/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neon/60 focus-visible:border-neon/60"
              aria-label={`View game: ${g.data.title}`}
            >
              <span class="font-semibold leading-snug group-hover:text-neon transition-colors">
                {g.data.title}
              </span>
              {g.data.excerpt && (
                <span class="mt-2 text-xs text-muted line-clamp-2">
                  {g.data.excerpt}
                </span>
              )}
            </a>
          </li>
        );
      })}
    </ul>
    <p class="mt-4 text-sm"><a class="hover:text-neon" href={withBase('games/')}>Browse all game types →</a></p>
  </section>

  <section class="mb-12">
    <h2 class="font-display text-2xl mb-4">Drinks</h2>
    <div class="grid gap-6 lg:grid-cols-2">
      <div>
        <h3 class="font-semibold mb-2">Cocktails</h3>
        <ul class="grid gap-2 list-none p-0 m-0">
          {cocktails.map(c => {
            const slug = (c.slug ?? c.id).split('/').pop();
            return (
              <li class="list-none p-0 m-0">
                <a
                  class="block rounded-sm px-3 py-2 border border-fg/15 hover:border-neon/40 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neon/60"
                  href={withBase(`drinks/cocktail-recipes/${slug}/`)}
                  aria-label={`View cocktail: ${c.data.title}`}
                >
                  <span class="font-medium">{c.data.title}</span>
                </a>
              </li>
            );
          })}
        </ul>
        <p class="mt-2 text-xs"><a class="hover:text-neon underline underline-offset-4" href={withBase('drinks/cocktail-recipes/')}>All cocktails →</a></p>
      </div>
      <div>
        <h3 class="font-semibold mb-2">Shots</h3>
        <ul class="grid gap-2 list-none p-0 m-0">
          {shots.map(s => {
            const slug = (s.slug ?? s.id).split('/').pop();
            return (
              <li class="list-none p-0 m-0">
                <a
                  class="block rounded-sm px-3 py-2 border border-fg/15 hover:border-neon/40 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neon/60"
                  href={withBase(`drinks/shot-recipes/${slug}/`)}
                  aria-label={`View shot: ${s.data.title}`}
                >
                  <span class="font-medium">{s.data.title}</span>
                </a>
              </li>
            );
          })}
        </ul>
        <p class="mt-2 text-xs"><a class="hover:text-neon underline underline-offset-4" href={withBase('drinks/shot-recipes/')}>All shots →</a></p>
      </div>
    </div>
  </section>

  {posts.length > 0 && (
    <section class="mb-12">
      <h2 class="font-display text-2xl mb-4">From the Blog</h2>
      <ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 list-none p-0 m-0">
        {posts.map(p => {
          const slug = (p.slug ?? p.id).split('/').pop();
          return (
            <li class="list-none p-0 m-0">
              <a
                href={withBase(`blog/${slug}/`)}
                class="group flex flex-col h-full border border-fg/20 rounded-sm p-4 transition-colors hover:border-neon/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-neon/60 focus-visible:border-neon/60"
                aria-label={`Read post: ${p.data.title}`}
              >
                <span class="font-semibold leading-snug group-hover:text-neon transition-colors">
                  {p.data.title}
                </span>
                {p.data.excerpt && (
                  <span class="mt-2 text-xs text-muted line-clamp-2">
                    {p.data.excerpt}
                  </span>
                )}
              </a>
            </li>
          );
        })}
      </ul>
    </section>
  )}
</Layout>
