---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';
import { canonical } from '../../lib/urls';
import { withBase } from '../../lib/paths';

const pageCanonical = canonical(Astro.url.pathname, Astro.site);

const collections = await Promise.all([
  getCollection('games').catch(()=>[]),
  getCollection('posts').catch(()=>[]),
  getCollection('cocktails').catch(()=>[]),
  getCollection('shots').catch(()=>[]),
  getCollection('activities').catch(()=>[])
]);

const tagMap = new Map<string, number>();
for (const group of collections) {
  for (const entry of group) {
    const tags = entry.data.tags;
    if (Array.isArray(tags)) {
      for (const t of tags) {
        const key = String(t).trim();
        if (!key) continue;
        tagMap.set(key, (tagMap.get(key) || 0) + 1);
      }
    }
  }
}
const tags = Array.from(tagMap.entries()).sort((a,b)=> a[0].localeCompare(b[0]));
---
<Layout title="Tags" description="Browse content by tag." canonical={pageCanonical} wide={true}>
  <h1 class="font-display text-3xl mb-6">Tags</h1>
  {tags.length === 0 ? (
    <p class="text-muted">No tags yet.</p>
  ) : (
    <ul class="flex flex-wrap gap-3 list-none p-0 m-0">
      {tags.map(([tag, count]) => (
        <li>
          <a
            href={withBase(`tags/${encodeURIComponent(tag)}/`)}
            class="inline-block px-3 py-1 border border-fg/25 rounded hover:border-neon hover:text-neon text-sm"
          >
            {tag} <span class="text-muted">({count})</span>
          </a>
        </li>
      ))}
    </ul>
  )}
</Layout>
