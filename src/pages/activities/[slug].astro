---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';
import { withBase } from '../../lib/paths';
import StructuredData from '../../components/StructuredData.astro';

export async function getStaticPaths() {
  const activities = await getCollection('activities');
  return activities.map(a => ({ params: { slug: a.slug }, props: { entry: a } }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const title = entry.data.title;
const description = entry.data.excerpt || `Activity: ${title}.`;
const difficulty = entry.data.difficulty;
const canonical = new URL(
  Astro.url.pathname,
  Astro.site ?? 'https://benbarraclough.github.io/BeerGoggleGames'
).toString();

const activityLd = {
  '@context': 'https://schema.org',
  '@type': 'CreativeWork',
  name: title,
  description,
  url: canonical,
  inLanguage: 'en'
};
---
<Layout title={title} description={description}>
  <article class="prose prose-invert max-w-none">
    {difficulty && <p><strong>Difficulty:</strong> {difficulty}</p>}
    <Content />
  </article>

  <p class="mt-8">
    <a class="hover:text-neon" href={withBase('activities/')}>‚Üê All Activities</a>
  </p>

  <StructuredData data={activityLd} />
</Layout>
